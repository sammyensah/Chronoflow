<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChronoFlow</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=Crimson+Pro:wght@600;700&display=swap" rel="stylesheet">
</head>
<body>

<!-- LANGUAGE SELECTOR (First time only) -->
<div id="langScreen" class="auth-screen" style="display:none">
    <div class="auth-bg"><div class="auth-particles" id="particlesLang"></div></div>
    <div class="auth-container">
        <div class="ob-welcome">
            <div class="ob-icon animate-pop">âš¡</div>
            <h1 class="ob-title animate-down">ChronoFlow</h1>
            <p class="ob-sub animate-down delay-1">Choisis ta langue</p>
        </div>
        <div class="lang-grid animate-up delay-2">
            <div class="lang-card" onclick="selectLang('fr')">
                <div class="lang-flag">ğŸ‡«ğŸ‡·</div>
                <div class="lang-name">FranÃ§ais</div>
            </div>
            <div class="lang-card" onclick="selectLang('en')">
                <div class="lang-flag">ğŸ‡¬ğŸ‡§</div>
                <div class="lang-name">English</div>
            </div>
            <div class="lang-card" onclick="selectLang('de')">
                <div class="lang-flag">ğŸ‡©ğŸ‡ª</div>
                <div class="lang-name">Deutsch</div>
            </div>
            <div class="lang-card" onclick="selectLang('es')">
                <div class="lang-flag">ğŸ‡ªğŸ‡¸</div>
                <div class="lang-name">EspaÃ±ol</div>
            </div>
            <div class="lang-card" onclick="selectLang('it')">
                <div class="lang-flag">ğŸ‡®ğŸ‡¹</div>
                <div class="lang-name">Italiano</div>
            </div>
            <div class="lang-card" onclick="selectLang('ar')">
                <div class="lang-flag">ğŸ‡¸ğŸ‡¦</div>
                <div class="lang-name">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</div>
            </div>
            <div class="lang-card" onclick="selectLang('pt')">
                <div class="lang-flag">ğŸ‡µğŸ‡¹</div>
                <div class="lang-name">PortuguÃªs</div>
            </div>
        </div>
    </div>
</div>

<!-- AUTH SCREEN -->
<div id="authScreen" class="auth-screen" style="display:none">
    <div class="auth-bg"><div class="auth-particles" id="particles"></div></div>
    <div class="auth-container">
        <div class="auth-logo animate-down">
            <span class="auth-logo-icon">âš¡</span>
            <h1 class="auth-logo-text">ChronoFlow</h1>
        </div>
        <p class="auth-tagline animate-down delay-1">Ton assistant planning intelligent</p>
        <div class="auth-tabs animate-down delay-2">
            <button class="auth-tab active" onclick="switchAuthTab('login')">Se connecter</button>
            <button class="auth-tab" onclick="switchAuthTab('register')">S'inscrire</button>
        </div>
        <div class="auth-form animate-up delay-3" id="loginForm">
            <div class="form-group">
                <label>Email</label>
                <input type="email" id="loginEmail" placeholder="toi@exemple.com">
            </div>
            <div class="form-group">
                <label>Mot de passe</label>
                <input type="password" id="loginPassword" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
            </div>
            <button class="btn-auth" onclick="handleLogin()">Se connecter â†’</button>
        </div>
        <div class="auth-form" id="registerForm" style="display:none">
            <div class="form-group">
                <label>PrÃ©nom *</label>
                <input type="text" id="regName" placeholder="Marie">
            </div>
            <div class="form-group">
                <label>Email *</label>
                <input type="email" id="regEmail" placeholder="toi@exemple.com">
            </div>
            <div class="form-group">
                <label>Mot de passe *</label>
                <input type="password" id="regPassword" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
            </div>
            <button class="btn-auth" onclick="handleRegister()">CrÃ©er mon compte â†’</button>
        </div>
    </div>
</div>

<!-- ONBOARDING -->
<div id="onboardingScreen" class="auth-screen" style="display:none">
    <div class="auth-bg"><div class="auth-particles" id="particles2"></div></div>
    <div class="auth-container wide">
        <div class="ob-step active" id="obStep1">
            <div class="ob-welcome">
                <div class="ob-icon animate-pop">âš¡</div>
                <h1 class="ob-title animate-down delay-1">Bienvenue sur<br><span>ChronoFlow</span></h1>
                <p class="ob-sub animate-down delay-2">Choisis ton profil</p>
            </div>
            <div class="profile-cards animate-up delay-3">
                <div class="profile-card-big" onclick="selectProfile('student')">
                    <div class="profile-card-icon">ğŸ“</div>
                    <h3>Ã‰tudiant</h3>
                    <p>Cours, rÃ©visions, examens</p>
                    <button class="btn-choose">Choisir</button>
                </div>
                <div class="profile-card-big" onclick="selectProfile('worker')">
                    <div class="profile-card-icon">ğŸ’¼</div>
                    <h3>Travailleur</h3>
                    <p>Projets, rÃ©unions</p>
                    <button class="btn-choose">Choisir</button>
                </div>
                <div class="profile-card-big" onclick="selectProfile('custom')">
                    <div class="profile-card-icon">âœ¨</div>
                    <h3>PersonnalisÃ©</h3>
                    <p>Je configure</p>
                    <button class="btn-choose">Choisir</button>
                </div>
            </div>
        </div>
        <div class="ob-step" id="obStep2">
            <h1 class="ob-title animate-down">ğŸ“ Configuration Ã‰tudiant</h1>
            <div class="ob-form animate-up delay-2">
                <div id="coursesContainer">
                    <div class="course-row">
                        <select class="sel"><option value="1">Lundi</option><option value="2">Mardi</option><option value="3">Mercredi</option><option value="4">Jeudi</option><option value="5">Vendredi</option><option value="6">Samedi</option></select>
                        <input type="time" class="tinp" value="08:00">
                        <input type="time" class="tinp" value="10:00">
                        <input type="text" class="sinp" placeholder="MatiÃ¨re">
                        <button class="btn-remove" onclick="removeCourse(this)">âœ•</button>
                    </div>
                </div>
                <button class="btn-secondary" onclick="addCourse()">+ Ajouter un cours</button>
                <div class="ob-btns">
                    <button class="btn-secondary" onclick="goObStep(1)">â† Retour</button>
                    <button class="btn-primary" onclick="finishOnboarding()">Terminer ğŸš€</button>
                </div>
            </div>
        </div>
        <div class="ob-step" id="obStep2w">
            <h1 class="ob-title animate-down">ğŸ’¼ Configuration Travailleur</h1>
            <div class="ob-form animate-up delay-2">
                <div style="display:grid;grid-template-columns:1fr 1fr;gap:1rem">
                    <div class="form-group"><label>DÃ©but</label><input type="time" id="workStart" value="09:00"></div>
                    <div class="form-group"><label>Fin</label><input type="time" id="workEnd" value="18:00"></div>
                </div>
                <div class="ob-btns">
                    <button class="btn-secondary" onclick="goObStep(1)">â† Retour</button>
                    <button class="btn-primary" onclick="finishOnboarding()">Terminer ğŸš€</button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- APP -->
<div id="appScreen" class="app-screen" style="display:none">

    <!-- Header -->
    <header class="header">
        <div class="header-left">
            <button class="btn-sidebar" id="sidebarHover">
                <span class="ham-line"></span>
                <span class="ham-line"></span>
                <span class="ham-line"></span>
            </button>
        </div>
        <div class="header-center">
            <div class="logo-link" onclick="reloadApp()">
                <span class="logo-icon">âš¡</span>
                <span class="logo-text">ChronoFlow</span>
            </div>
        </div>
        <div class="header-right">
            <button class="header-btn theme-btn" onclick="toggleTheme()" id="themeBtn">ğŸŒ™</button>
            <div class="streak-badge" onclick="switchView('badges')" title="Voir les badges">
                <span>ğŸ”¥</span>
                <span id="headerStreak">0</span>
            </div>
            <button class="avatar-btn" onclick="switchView('profile')">
                <span id="headerAvatarEmoji">ğŸ‘¤</span>
                <img id="headerAvatarImg" src="" alt="" style="display:none">
            </button>
        </div>
    </header>

    <div class="app-body">
        <!-- Sidebar Mini -->
        <aside class="sidebar-mini" id="sidebar">
            <nav class="nav-mini">
                <button class="nav-mini-btn active" data-view="planning" onclick="switchView('planning')" title="Planning">
                    <span class="nav-mini-icon">ğŸ“‹</span>
                    <span class="nav-mini-label">Planning</span>
                </button>
                <button class="nav-mini-btn" data-view="calendar" onclick="switchView('calendar')" title="Calendrier">
                    <span class="nav-mini-icon">ğŸ“…</span>
                    <span class="nav-mini-label">Calendrier</span>
                </button>
                <button class="nav-mini-btn" data-view="insights" onclick="switchView('insights')" title="Insights">
                    <span class="nav-mini-icon">ğŸ“Š</span>
                    <span class="nav-mini-label">Insights</span>
                </button>
                <button class="nav-mini-btn" data-view="templates" onclick="switchView('templates')" title="Templates">
                    <span class="nav-mini-icon">âš™ï¸</span>
                    <span class="nav-mini-label">Templates</span>
                </button>
                <button class="nav-mini-btn" data-view="badges" onclick="switchView('badges')" title="Badges">
                    <span class="nav-mini-icon">ğŸ†</span>
                    <span class="nav-mini-label">Badges</span>
                </button>
                <button class="nav-mini-btn" data-view="settings" onclick="switchView('settings')" title="ParamÃ¨tres">
                    <span class="nav-mini-icon">âš™ï¸</span>
                    <span class="nav-mini-label">ParamÃ¨tres</span>
                </button>
            </nav>
        </aside>

        <!-- Content -->
        <main class="content">

            <!-- Mascot -->
            <div class="mascot" id="mascot">
                <div class="mascot-char">âš¡</div>
                <div class="mascot-bubble" id="mascotBubble">Bienvenue !</div>
            </div>

            <!-- AI Input -->
            <div class="ai-panel" id="aiPanel">
                <div class="ai-inner">
                    <textarea id="aiInput" placeholder="Dis-moi ce que tu veux planifier...&#10;Ex: J'ai une Ã©val de maths dans 3 jours et j'ai rien rÃ©visÃ©"></textarea>
                    <div class="ai-actions">
                        <div class="quick-tags">
                            <button class="tag" data-txt="Je suis fatiguÃ© cette semaine" onclick="addTag(this)">ğŸ˜´ FatiguÃ©</button>
                            <button class="tag" data-txt="J'ai un examen important et j'ai rien rÃ©visÃ©" onclick="addTag(this)">ğŸ“š Examen</button>
                            <button class="tag" data-txt="Voir mes amis ce weekend" onclick="addTag(this)">ğŸ‘¥ Amis</button>
                            <button class="tag" data-txt="Sport 3 fois cette semaine" onclick="addTag(this)">ğŸƒ Sport</button>
                            <button class="tag" data-txt="Besoin d'Ã©quilibre vie perso et travail" onclick="addTag(this)">âš–ï¸ Ã‰quilibre</button>
                        </div>
                        <div class="ai-right-actions">
                            <button class="btn-voice" onclick="startVoice()" id="voiceBtn">ğŸ¤</button>
                            <button class="btn-generate" onclick="generate()">
                                <span>GÃ©nÃ©rer</span>
                                <span>âœ¨</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Planning View -->
            <div class="view active" id="viewPlanning">
                <div class="view-header">
                    <h2>Mon Planning <span class="template-badge" id="planningTemplateBadge"></span></h2>
                    <div class="week-nav">
                        <button class="nav-arrow" onclick="changeWeek(-1)">â†</button>
                        <span id="weekLabel">Cette semaine</span>
                        <button class="nav-arrow" onclick="changeWeek(1)">â†’</button>
                    </div>
                </div>
                <div class="priority-legend">
                    <span>PrioritÃ©s :</span>
                    <span class="pill critical">ğŸ”´ Critique</span>
                    <span class="pill high">ğŸŸ  Haute</span>
                    <span class="pill medium">ğŸŸ¡ Moyenne</span>
                    <span class="pill low">ğŸŸ¢ Basse</span>
                </div>
                <div id="planningGrid" class="planning-grid">
                    <div class="empty-state">
                        <div class="empty-icon">ğŸ“…</div>
                        <h3>Planning vide</h3>
                        <p>Utilise l'IA pour planifier</p>
                    </div>
                </div>
                <div class="event-sections">
                    <div class="event-section">
                        <h3>ğŸ“ Aujourd'hui</h3>
                        <div id="todayList"><p class="hint">Rien</p></div>
                    </div>
                    <div class="event-section">
                        <h3>ğŸ“… Ã€ venir</h3>
                        <div id="upcomingList"><p class="hint">Rien</p></div>
                    </div>
                </div>
            </div>

            <!-- Calendar View -->
            <div class="view" id="viewCalendar">
                <div class="view-header">
                    <h2>Calendrier</h2>
                    <div class="week-nav">
                        <button class="nav-arrow" onclick="changeMonth(-1)">â†</button>
                        <span id="monthLabel">FÃ©vrier 2026</span>
                        <button class="nav-arrow" onclick="changeMonth(1)">â†’</button>
                    </div>
                </div>
                <div id="monthCal" class="month-cal"></div>
            </div>

            <!-- Insights View -->
            <div class="view" id="viewInsights">
                <div class="view-header"><h2>Insights ğŸ“Š</h2></div>
                <div id="insightsGrid" class="insights-grid"></div>
            </div>

            <!-- Templates View -->
            <div class="view" id="viewTemplates">
                <div class="view-header"><h2>Templates</h2></div>
                <div id="templatesContent"></div>
            </div>

            <!-- Badges View -->
            <div class="view" id="viewBadges">
                <div class="view-header"><h2>Badges ğŸ†</h2></div>
                <div class="streak-hero">
                    <div class="streak-flame">ğŸ”¥</div>
                    <div>
                        <h2><span id="streakCount">0</span> jours</h2>
                        <p id="streakMsg">Continue !</p>
                    </div>
                </div>
                <div id="badgeGrid" class="badge-grid"></div>
            </div>

            <!-- Profile View -->
            <div class="view" id="viewProfile">
                <div class="view-header"><h2>Profil</h2></div>
                <div class="profile-layout">
                    <div class="profile-left">
                        <div class="profile-avatar-wrap">
                            <div class="profile-avatar">
                                <span id="profileAvatarEmoji">ğŸ‘¤</span>
                                <img id="profileAvatarImg" src="" alt="" style="display:none">
                                <div class="camera-overlay" onclick="document.getElementById('avatarFileInput').click()">ğŸ“·</div>
                            </div>
                            <input type="file" id="avatarFileInput" accept="image/*" style="display:none" onchange="handleAvatarChange(this)">
                        </div>
                        <h3 id="profileName">User</h3>
                        <p id="profileEmail"></p>
                    </div>
                    <div class="profile-right">
                        <div class="stats-grid">
                            <div class="stat-card"><span class="stat-val" id="statEvents">0</span><span class="stat-lbl">Ã‰vÃ©nements</span></div>
                            <div class="stat-card"><span class="stat-val" id="statStreak">0</span><span class="stat-lbl">Jours</span></div>
                            <div class="stat-card"><span class="stat-val" id="statHours">0</span><span class="stat-lbl">Heures</span></div>
                            <div class="stat-card"><span class="stat-val" id="statBadges">0</span><span class="stat-lbl">Badges</span></div>
                        </div>
                        <div class="profile-settings">
                            <h3>Infos</h3>
                            <div class="form-group"><label>PrÃ©nom</label><input type="text" id="profileNameInput"></div>
                            <div class="form-group"><label>Email (non modifiable)</label><input type="email" id="profileEmailInput" disabled></div>
                            <button class="btn-primary" onclick="saveProfile()">Sauvegarder</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Settings View -->
            <div class="view" id="viewSettings">
                <div class="view-header"><h2>ParamÃ¨tres âš™ï¸</h2></div>
                <div class="settings-content">
                    <div class="setting-card">
                        <h3>ğŸŒ Langue</h3>
                        <select id="settingsLang" onchange="changeLang(this.value)">
                            <option value="fr">ğŸ‡«ğŸ‡· FranÃ§ais</option>
                            <option value="en">ğŸ‡¬ğŸ‡§ English</option>
                            <option value="de">ğŸ‡©ğŸ‡ª Deutsch</option>
                            <option value="es">ğŸ‡ªğŸ‡¸ EspaÃ±ol</option>
                            <option value="it">ğŸ‡®ğŸ‡¹ Italiano</option>
                            <option value="ar">ğŸ‡¸ğŸ‡¦ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
                            <option value="pt">ğŸ‡µğŸ‡¹ PortuguÃªs</option>
                        </select>
                    </div>
                    <div class="setting-card">
                        <h3>ğŸ”” Notifications</h3>
                        <label class="switch-row"><span>Ã‰vÃ©nements Ã  venir</span><input type="checkbox" id="notifEvents" checked><span class="switch"></span></label>
                        <label class="switch-row"><span>Rappels quotidiens</span><input type="checkbox" id="notifDaily" checked><span class="switch"></span></label>
                    </div>
                    <div class="setting-card">
                        <h3>ğŸ”’ ConfidentialitÃ©</h3>
                        <button class="btn-secondary" onclick="requestPasswordChange()">Changer le mot de passe</button>
                        <p style="font-size:0.85rem;color:var(--text2);margin-top:0.5rem">Un email de confirmation sera envoyÃ©</p>
                    </div>
                    <div class="setting-card">
                        <h3>ğŸ“Š DonnÃ©es</h3>
                        <button class="btn-secondary" onclick="exportData()">Exporter mes donnÃ©es</button>
                        <button class="btn-secondary" onclick="deleteAccount()" style="margin-top:0.5rem;background:rgba(239,68,68,0.1);color:var(--critical)">Supprimer mon compte</button>
                    </div>
                </div>
            </div>

        </main>
    </div>
</div>

<!-- Day Detail Modal -->
<div class="modal-full" id="dayDetailModal">
    <div class="modal-full-content">
        <button class="modal-close-btn" onclick="closeDayDetail()">âœ•</button>
        <div id="dayDetailContent"></div>
    </div>
</div>

<!-- Insight Detail Modal -->
<div class="modal-full" id="insightDetailModal">
    <div class="modal-full-content">
        <button class="modal-close-btn" onclick="closeInsightDetail()">âœ•</button>
        <div id="insightDetailContent"></div>
    </div>
</div>

<!-- Event Detail Modal -->
<div class="modal" id="eventDetailModal">
    <div class="modal-box">
        <h3 id="eventDetailTitle">DÃ©tails</h3>
        <div id="eventDetailBody"></div>
        <div class="priority-selector" id="prioritySelector">
            <label>PrioritÃ© :</label>
            <button class="priority-btn critical" onclick="changePriority('critical')">ğŸ”´ Critique</button>
            <button class="priority-btn high" onclick="changePriority('high')">ğŸŸ  Haute</button>
            <button class="priority-btn medium" onclick="changePriority('medium')">ğŸŸ¡ Moyenne</button>
            <button class="priority-btn low" onclick="changePriority('low')">ğŸŸ¢ Basse</button>
        </div>
        <div class="modal-btns">
            <button class="btn-secondary" onclick="closeEventDetail()">Fermer</button>
        </div>
    </div>
</div>

<!-- Password Change Modal -->
<div class="modal" id="passwordModal">
    <div class="modal-box">
        <h3>ğŸ”’ Changer le mot de passe</h3>
        <p style="font-size:0.9rem;color:var(--text2);margin-bottom:1rem">Un code a Ã©tÃ© envoyÃ© Ã  <strong id="pwdEmail"></strong></p>
        <div class="form-group"><label>Code de vÃ©rification</label><input type="text" id="pwdCode" placeholder="123456"></div>
        <div class="form-group"><label>Nouveau mot de passe</label><input type="password" id="pwdNew" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"></div>
        <div class="modal-btns">
            <button class="btn-secondary" onclick="closeModal('passwordModal')">Annuler</button>
            <button class="btn-primary" onclick="confirmPasswordChange()">Confirmer</button>
        </div>
    </div>
</div>

<!-- Voice Modal -->
<div class="modal" id="voiceModal">
    <div class="modal-box">
        <h3>ğŸ¤ Enregistrement</h3>
        <div class="voice-indicator">
            <div class="voice-ring"></div>
            <div class="voice-ring delay1"></div>
            <div class="voice-ring delay2"></div>
            <span>ğŸ¤</span>
        </div>
        <p id="voiceStatus">Parle...</p>
        <p id="voiceTranscript" class="voice-transcript"></p>
        <div class="modal-btns">
            <button class="btn-secondary" onclick="stopVoice()">Annuler</button>
            <button class="btn-primary" id="voiceConfirm" onclick="confirmVoice()" style="display:none">Utiliser</button>
        </div>
    </div>
</div>

<!-- Toast -->
<div class="toast" id="toast">
    <span class="toast-icon">âœ¨</span>
    <span id="toastMsg"></span>
</div>

<!-- Loading -->
<div class="loading" id="loading">
    <div class="loading-inner">
        <div class="loading-ring"></div>
        <p>L'IA analyse...</p>
    </div>
</div>

<script src="script.js"></script>
</body>
</html>
