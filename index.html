<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChronoFlow</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=Crimson+Pro:wght@600;700&display=swap" rel="stylesheet">
</head>
<body>

<!-- â•â•â•â•â•â•â•â•â•â•â• AUTH SCREEN â•â•â•â•â•â•â•â•â•â•â• -->
<div id="authScreen" class="auth-screen">
    <div class="auth-bg">
        <div class="auth-particles" id="particles"></div>
    </div>
    <div class="auth-container">
        <div class="auth-logo animate-down">
            <span class="auth-logo-icon">âš¡</span>
            <h1 class="auth-logo-text">ChronoFlow</h1>
        </div>
        <p class="auth-tagline animate-down delay-1">Ton assistant planning intelligent</p>

        <!-- Tabs Login / Register -->
        <div class="auth-tabs animate-down delay-2">
            <button class="auth-tab active" onclick="switchAuthTab('login')">Se connecter</button>
            <button class="auth-tab" onclick="switchAuthTab('register')">S'inscrire</button>
        </div>

        <!-- Login Form -->
        <div class="auth-form animate-up delay-3" id="loginForm">
            <div class="form-group">
                <label>Email</label>
                <input type="email" id="loginEmail" placeholder="toi@exemple.com" autocomplete="email">
            </div>
            <div class="form-group">
                <label>Mot de passe</label>
                <input type="password" id="loginPassword" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" autocomplete="current-password">
            </div>
            <button class="btn-auth" onclick="handleLogin()">Se connecter â†’</button>
        </div>

        <!-- Register Form -->
        <div class="auth-form" id="registerForm" style="display:none">
            <div class="form-group">
                <label>PrÃ©nom *</label>
                <input type="text" id="regName" placeholder="Ex: Marie" autocomplete="given-name">
            </div>
            <div class="form-group">
                <label>Email *</label>
                <input type="email" id="regEmail" placeholder="toi@exemple.com" autocomplete="email">
            </div>
            <div class="form-group">
                <label>Mot de passe *</label>
                <input type="password" id="regPassword" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" autocomplete="new-password">
            </div>
            <button class="btn-auth" onclick="handleRegister()">CrÃ©er mon compte â†’</button>
        </div>
    </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â• ONBOARDING â•â•â•â•â•â•â•â•â•â•â• -->
<div id="onboardingScreen" class="auth-screen" style="display:none">
    <div class="auth-bg">
        <div class="auth-particles" id="particles2"></div>
    </div>
    <div class="auth-container wide">
        <!-- Step 1: Welcome -->
        <div class="ob-step active" id="obStep1">
            <div class="ob-welcome">
                <div class="ob-icon animate-pop">âš¡</div>
                <h1 class="ob-title animate-down delay-1">Bienvenue sur<br><span>ChronoFlow</span></h1>
                <p class="ob-sub animate-down delay-2">Choisis ton profil pour personnaliser ton expÃ©rience</p>
            </div>
            <div class="profile-cards animate-up delay-3">
                <div class="profile-card-big" onclick="selectProfile('student')">
                    <div class="profile-card-icon">ğŸ“</div>
                    <h3>Ã‰tudiant</h3>
                    <p>Cours, rÃ©visions, examens</p>
                    <button class="btn-choose">Choisir</button>
                </div>
                <div class="profile-card-big" onclick="selectProfile('worker')">
                    <div class="profile-card-icon">ğŸ’¼</div>
                    <h3>Travailleur</h3>
                    <p>Projets, rÃ©unions, deadlines</p>
                    <button class="btn-choose">Choisir</button>
                </div>
                <div class="profile-card-big" onclick="selectProfile('custom')">
                    <div class="profile-card-icon">âœ¨</div>
                    <h3>PersonnalisÃ©</h3>
                    <p>Je configure moi-mÃªme</p>
                    <button class="btn-choose">Choisir</button>
                </div>
            </div>
        </div>

        <!-- Step 2: Student Config -->
        <div class="ob-step" id="obStep2">
            <h1 class="ob-title animate-down">ğŸ“ Configuration Ã‰tudiant</h1>
            <p class="ob-sub animate-down delay-1">Entre ton emploi du temps</p>
            <div class="ob-form animate-up delay-2">
                <div id="coursesContainer">
                    <div class="course-row">
                        <select class="sel"><option value="1">Lundi</option><option value="2">Mardi</option><option value="3">Mercredi</option><option value="4">Jeudi</option><option value="5">Vendredi</option><option value="6">Samedi</option></select>
                        <input type="time" class="tinp" value="08:00">
                        <input type="time" class="tinp" value="10:00">
                        <input type="text" class="sinp" placeholder="MatiÃ¨re (ex: Maths)">
                        <button class="btn-remove" onclick="removeCourse(this)">âœ•</button>
                    </div>
                </div>
                <button class="btn-secondary" onclick="addCourse()">+ Ajouter un cours</button>
                <div class="form-group" style="margin-top:1.5rem">
                    <label>DurÃ©e de rÃ©vision idÃ©ale</label>
                    <select id="sessionDuration"><option value="60">1 heure</option><option value="90" selected>1h30</option><option value="120">2 heures</option><option value="180">3 heures</option></select>
                </div>
                <div class="form-group">
                    <label>Moment prÃ©fÃ©rÃ©</label>
                    <select id="preferredTime"><option value="morning">Matin (8h-12h)</option><option value="afternoon" selected>AprÃ¨s-midi (14h-18h)</option><option value="evening">Soir (18h-22h)</option></select>
                </div>
                <div class="ob-btns">
                    <button class="btn-secondary" onclick="goObStep(1)">â† Retour</button>
                    <button class="btn-primary" onclick="finishOnboarding()">Terminer ğŸš€</button>
                </div>
            </div>
        </div>

        <!-- Step 2b: Worker Config -->
        <div class="ob-step" id="obStep2w">
            <h1 class="ob-title animate-down">ğŸ’¼ Configuration Travailleur</h1>
            <p class="ob-sub animate-down delay-1">Tes horaires de travail</p>
            <div class="ob-form animate-up delay-2">
                <div style="display:grid;grid-template-columns:1fr 1fr;gap:1rem">
                    <div class="form-group"><label>DÃ©but</label><input type="time" id="workStart" value="09:00"></div>
                    <div class="form-group"><label>Fin</label><input type="time" id="workEnd" value="18:00"></div>
                </div>
                <div class="form-group">
                    <label>Jours travaillÃ©s</label>
                    <div class="day-checks">
                        <label class="day-check"><input type="checkbox" checked> Lun</label>
                        <label class="day-check"><input type="checkbox" checked> Mar</label>
                        <label class="day-check"><input type="checkbox" checked> Mer</label>
                        <label class="day-check"><input type="checkbox" checked> Jeu</label>
                        <label class="day-check"><input type="checkbox" checked> Ven</label>
                        <label class="day-check"><input type="checkbox"> Sam</label>
                        <label class="day-check"><input type="checkbox"> Dim</label>
                    </div>
                </div>
                <div class="ob-btns">
                    <button class="btn-secondary" onclick="goObStep(1)">â† Retour</button>
                    <button class="btn-primary" onclick="finishOnboarding()">Terminer ğŸš€</button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â• APP â•â•â•â•â•â•â•â•â•â•â• -->
<div id="appScreen" class="app-screen" style="display:none">

    <!-- Header -->
    <header class="header">
        <div class="header-left">
            <button class="btn-sidebar" id="sidebarToggle" onclick="toggleSidebar()" title="Menu">
                <span class="ham-line"></span>
                <span class="ham-line"></span>
                <span class="ham-line"></span>
            </button>
            <div class="logo-link" onclick="reloadApp()" title="Retour accueil">
                <span class="logo-icon">âš¡</span>
                <span class="logo-text">ChronoFlow</span>
            </div>
        </div>
        <div class="header-right">
            <button class="header-btn" onclick="toggleTheme()" id="themeBtn" title="ThÃ¨me">ğŸŒ™</button>
            <div class="streak-badge">
                <span>ğŸ”¥</span>
                <span id="headerStreak">0</span>
            </div>
            <button class="avatar-btn" onclick="switchView('profile')" id="headerAvatarBtn" title="Mon profil">
                <span id="headerAvatarEmoji">ğŸ‘¤</span>
                <img id="headerAvatarImg" src="" alt="" style="display:none">
            </button>
        </div>
    </header>

    <div class="app-body">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <nav class="nav">
                <button class="nav-btn active" data-view="planning" onclick="switchView('planning')">
                    <span class="nav-icon">ğŸ“‹</span>
                    <span>Planning</span>
                </button>
                <button class="nav-btn" data-view="calendar" onclick="switchView('calendar')">
                    <span class="nav-icon">ğŸ“…</span>
                    <span>Calendrier</span>
                </button>
                <button class="nav-btn" data-view="insights" onclick="switchView('insights')">
                    <span class="nav-icon">ğŸ“Š</span>
                    <span>Insights</span>
                </button>
                <button class="nav-btn" data-view="templates" onclick="switchView('templates')">
                    <span class="nav-icon">âš™ï¸</span>
                    <span>Templates</span>
                </button>
                <button class="nav-btn" data-view="badges" onclick="switchView('badges')">
                    <span class="nav-icon">ğŸ†</span>
                    <span>Badges</span>
                </button>
            </nav>

            <div class="sidebar-footer">
                <h4>Sync</h4>
                <button class="sync-btn" data-platform="google" onclick="syncCalendar(this)">
                    <span>ğŸ“—</span><span>Google Calendar</span>
                    <span class="sync-status" id="syncGoogle"></span>
                </button>
                <button class="sync-btn" data-platform="apple" onclick="syncCalendar(this)">
                    <span>ğŸ</span><span>Apple Calendar</span>
                    <span class="sync-status" id="syncApple"></span>
                </button>
                <button class="sync-btn" data-platform="notion" onclick="syncCalendar(this)">
                    <span>ğŸ“</span><span>Notion</span>
                    <span class="sync-status" id="syncNotion"></span>
                </button>
            </div>
        </aside>

        <!-- Content -->
        <main class="content">

            <!-- AI Input (Planning only) -->
            <div class="ai-panel" id="aiPanel">
                <div class="ai-inner">
                    <textarea id="aiInput" placeholder="Dis-moi ce que tu veux planifier...&#10;Ex: 'J\'ai une Ã©val de maths dans 3 jours et j\'ai rien rÃ©visÃ©'&#10;Ex: 'Voir mes amis samedi soir, sport 3 fois cette semaine'"></textarea>
                    <div class="ai-actions">
                        <div class="quick-tags">
                            <button class="tag" data-txt="Je suis fatiguÃ© cette semaine" onclick="addTag(this)">ğŸ˜´ FatiguÃ©</button>
                            <button class="tag" data-txt="J'ai un examen important et j'ai rien rÃ©visÃ©" onclick="addTag(this)">ğŸ“š Examen</button>
                            <button class="tag" data-txt="Voir mes amis ce weekend" onclick="addTag(this)">ğŸ‘¥ Amis</button>
                            <button class="tag" data-txt="Sport 3 fois cette semaine" onclick="addTag(this)">ğŸƒ Sport</button>
                            <button class="tag" data-txt="Besoin d'Ã©quilibre vie perso et travail" onclick="addTag(this)">âš–ï¸ Ã‰quilibre</button>
                        </div>
                        <div class="ai-right-actions">
                            <button class="btn-voice" onclick="startVoice()" title="Message vocal" id="voiceBtn">ğŸ¤</button>
                            <button class="btn-generate" onclick="generate()">
                                <span>GÃ©nÃ©rer mon planning</span>
                                <span>âœ¨</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- â”€â”€ Planning View â”€â”€ -->
            <div class="view active" id="viewPlanning">
                <div class="view-header">
                    <div>
                        <h2>Mon Planning <span class="template-badge" id="planningTemplateBadge"></span></h2>
                    </div>
                    <div class="week-nav">
                        <button class="nav-arrow" onclick="changeWeek(-1)">â†</button>
                        <span id="weekLabel">Cette semaine</span>
                        <button class="nav-arrow" onclick="changeWeek(1)">â†’</button>
                    </div>
                </div>
                <div class="priority-legend">
                    <span>PrioritÃ©s :</span>
                    <span class="pill critical">ğŸ”´ Critique</span>
                    <span class="pill high">ğŸŸ  Haute</span>
                    <span class="pill medium">ğŸŸ¡ Moyenne</span>
                    <span class="pill low">ğŸŸ¢ Basse</span>
                </div>
                <div id="planningGrid" class="planning-grid">
                    <div class="empty-state">
                        <div class="empty-icon">ğŸ“…</div>
                        <h3>Planning vide</h3>
                        <p>Utilise l'IA pour planifier tes journÃ©es</p>
                    </div>
                </div>
                <div class="event-sections">
                    <div class="event-section">
                        <h3>ğŸ“ Aujourd'hui</h3>
                        <div id="todayList"><p class="hint">Rien pour aujourd'hui</p></div>
                    </div>
                    <div class="event-section">
                        <h3>ğŸ“… Ã€ venir</h3>
                        <div id="upcomingList"><p class="hint">Rien Ã  venir</p></div>
                    </div>
                </div>
            </div>

            <!-- â”€â”€ Calendar View â”€â”€ -->
            <div class="view" id="viewCalendar">
                <div class="view-header">
                    <h2>Calendrier</h2>
                    <div class="week-nav">
                        <button class="nav-arrow" onclick="changeMonth(-1)">â†</button>
                        <span id="monthLabel">FÃ©vrier 2026</span>
                        <button class="nav-arrow" onclick="changeMonth(1)">â†’</button>
                    </div>
                </div>
                <div id="monthCal" class="month-cal"></div>
            </div>

            <!-- â”€â”€ Insights View â”€â”€ -->
            <div class="view" id="viewInsights">
                <div class="view-header"><h2>Insights ğŸ“Š</h2></div>
                <div id="insightsGrid" class="insights-grid"></div>
            </div>

            <!-- â”€â”€ Templates View â”€â”€ -->
            <div class="view" id="viewTemplates">
                <div class="view-header"><h2>Templates</h2></div>
                <div id="templatesContent"></div>
            </div>

            <!-- â”€â”€ Badges View â”€â”€ -->
            <div class="view" id="viewBadges">
                <div class="view-header"><h2>Badges ğŸ†</h2></div>
                <div class="streak-hero">
                    <div class="streak-flame">ğŸ”¥</div>
                    <div>
                        <h2><span id="streakCount">0</span> jours</h2>
                        <p id="streakMsg">Continue chaque jour !</p>
                    </div>
                </div>
                <div id="badgeGrid" class="badge-grid"></div>
            </div>

            <!-- â”€â”€ Profile View â”€â”€ -->
            <div class="view" id="viewProfile">
                <div class="view-header"><h2>Mon Profil</h2></div>
                <div class="profile-layout">
                    <div class="profile-left">
                        <div class="profile-avatar-wrap">
                            <div class="profile-avatar" id="profileAvatarWrap">
                                <span id="profileAvatarEmoji">ğŸ‘¤</span>
                                <img id="profileAvatarImg" src="" alt="" style="display:none">
                                <div class="camera-overlay" onclick="document.getElementById('avatarFileInput').click()" title="Changer la photo">ğŸ“·</div>
                            </div>
                            <input type="file" id="avatarFileInput" accept="image/*" style="display:none" onchange="handleAvatarChange(this)">
                        </div>
                        <h3 id="profileName">Utilisateur</h3>
                        <p id="profileEmail" style="color:var(--text2);font-size:0.9rem"></p>
                    </div>
                    <div class="profile-right">
                        <div class="stats-grid">
                            <div class="stat-card">
                                <span class="stat-val" id="statEvents">0</span>
                                <span class="stat-lbl">Ã‰vÃ©nements</span>
                            </div>
                            <div class="stat-card">
                                <span class="stat-val" id="statStreak">0</span>
                                <span class="stat-lbl">Jours streak</span>
                            </div>
                            <div class="stat-card">
                                <span class="stat-val" id="statHours">0</span>
                                <span class="stat-lbl">Heures</span>
                            </div>
                            <div class="stat-card">
                                <span class="stat-val" id="statBadges">0</span>
                                <span class="stat-lbl">Badges</span>
                            </div>
                        </div>
                        <div class="profile-settings">
                            <h3>ParamÃ¨tres</h3>
                            <div class="form-group">
                                <label>PrÃ©nom</label>
                                <input type="text" id="profileNameInput">
                            </div>
                            <div class="form-group">
                                <label>Email <span style="font-size:0.75rem;color:var(--text2)">(non modifiable)</span></label>
                                <input type="email" id="profileEmailInput" disabled style="opacity:0.6;cursor:not-allowed">
                            </div>
                            <button class="btn-primary" onclick="saveProfile()">Sauvegarder</button>
                        </div>
                    </div>
                </div>
            </div>

        </main>
    </div>
</div>

<!-- Workload alert -->
<div class="modal" id="workloadModal">
    <div class="modal-box">
        <h3 id="workloadTitle">âš ï¸ Attention</h3>
        <p id="workloadMsg"></p>
        <div class="modal-btns">
            <button class="btn-secondary" onclick="closeModal('workloadModal')">Garder</button>
            <button class="btn-primary" onclick="adjustWorkload()">Ajuster</button>
        </div>
    </div>
</div>

<!-- Voice modal -->
<div class="modal" id="voiceModal">
    <div class="modal-box">
        <h3>ğŸ¤ Enregistrement vocal</h3>
        <div class="voice-indicator" id="voiceIndicator">
            <div class="voice-ring"></div>
            <div class="voice-ring delay1"></div>
            <div class="voice-ring delay2"></div>
            <span>ğŸ¤</span>
        </div>
        <p id="voiceStatus">Parle maintenant...</p>
        <p id="voiceTranscript" class="voice-transcript"></p>
        <div class="modal-btns">
            <button class="btn-secondary" onclick="stopVoice()">Annuler</button>
            <button class="btn-primary" id="voiceConfirm" onclick="confirmVoice()" style="display:none">Utiliser ce texte</button>
        </div>
    </div>
</div>

<!-- Toast -->
<div class="toast" id="toast">
    <span class="toast-icon">âœ¨</span>
    <span id="toastMsg"></span>
</div>

<!-- Loading -->
<div class="loading" id="loading">
    <div class="loading-inner">
        <div class="loading-ring"></div>
        <p>L'IA analyse ta demande...</p>
    </div>
</div>

<script src="script.js"></script>
</body>
</html>
